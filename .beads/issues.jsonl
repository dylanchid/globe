{"id":"world-0tf","title":"Globe Codebase Refactoring Epic","description":"Master epic for refactoring and improving the terminal globe codebase.\n\n## Goals\n- Fix documentation/implementation mismatches\n- Implement missing keyboard controls\n- Optimize render performance\n- Clean up code quality issues\n- Add proper error handling\n\n## Success Criteria\n- All documented features work\n- 20%+ FPS improvement\n- No global state mutations\n- Type hints on all functions","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-02T01:43:42.263499-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:43:42.263499-08:00"}
{"id":"world-1pt","title":"Fix lighting direction inconsistency","description":"Light direction changes unrealistically between day/night modes.\n\n## Current Code\n```python\nlight_dir = (-0.6, 0.5, 0.6) if night_mode else (0.6, 0.5, 0.6)\n```\n\nThe light direction flips sign on X-axis when toggling night mode. This makes the 'sun' jump to the opposite side of the globe.\n\n## Expected Behavior\nLight source should remain in the same position. Night mode should only change:\n- Color palette used for rendering\n- Whether city lights are visible\n- Potentially atmosphere color\n\n## Fix\nKeep light_dir constant:\n```python\nlight_dir = (0.6, 0.5, 0.6)  # Fixed sun position\n```\n\n## Files\n- globe.py render_frame() function","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T01:45:07.093552-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:55:19.711639-08:00","closed_at":"2026-01-02T01:55:19.711639-08:00","close_reason":"Implemented keyboard controls (1-4 quality, l for city lights), fixed lighting direction to stay constant, updated README.md and IMPLEMENTATION.md to accurately describe rasterization-based rendering"}
{"id":"world-2ae","title":"Extract magic numbers to named constants","description":"Multiple magic numbers scattered throughout render_frame() reduce readability.\n\n## Magic Numbers Found\n```python\nif 1.0 \u003c r \u003c 1.12:           # Atmosphere outer radius\nglow = 1.0 - (r - 1.0) / 0.12  # Atmosphere falloff\nif spec_dist \u003c 0.12 and intensity \u003e 0.4:  # Specular thresholds\nif ry \u003c 0.1:  # Visibility threshold for city lights\nglow \u003e 0.7, 0.4, 0.2  # Atmosphere dot density thresholds\n```\n\n## Solution\nAdd constants to GlobeConfig or module-level:\n```python\nATMOSPHERE_OUTER_RADIUS = 1.12\nATMOSPHERE_FALLOFF = 0.12\nSPECULAR_RADIUS = 0.12\nSPECULAR_MIN_INTENSITY = 0.4\nCITY_VISIBILITY_THRESHOLD = 0.1\n```\n\n## Files\n- globe.py","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T01:44:29.836143-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:44:29.836143-08:00"}
{"id":"world-2jm","title":"Extract color gradient helper function","description":"Duplicate logic for color gradient selection.\n\n## Repeated Pattern\n```python\nidx = min(int(avg_intensity * len(LAND_COLORS)), len(LAND_COLORS) - 1)\nfinal_colors[cy][cx] = LAND_COLORS[idx]\n# ... same pattern for LAND_NIGHT_COLORS, OCEAN_COLORS\n```\n\n## Proposed Helper\n```python\ndef get_gradient_color(intensity: float, palette: List[str]) -\u003e str:\n    '''Select color from palette based on intensity (0.0-1.0).'''\n    idx = min(int(intensity * len(palette)), len(palette) - 1)\n    return palette[idx]\n```\n\n## Usage\n```python\nfinal_colors[cy][cx] = get_gradient_color(avg_intensity, LAND_COLORS)\n```\n\n## Files\n- globe.py","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T01:48:06.640085-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:48:06.640085-08:00","dependencies":[{"issue_id":"world-2jm","depends_on_id":"world-6lj","type":"blocks","created_at":"2026-01-02T01:48:53.727264-08:00","created_by":"dylanchidambaram"}]}
{"id":"world-2ly","title":"Implement missing keyboard controls","description":"Several documented keyboard controls are not implemented.\n\n## Missing Controls\n1. Quality levels: keys 1, 2, 3, 4 should adjust detail_level\n2. Key 'l' should toggle city lights (currently only 'c' works)\n\n## Implementation Location\n- globe.py main() function, key handler section (~lines 755-775)\n\n## Current Key Handler Code\n```python\nelif key == 'c':\n    CONFIG.enable_city_lights = not CONFIG.enable_city_lights\n```\n\n## Required Changes\nAdd handlers for '1', '2', '3', '4' keys to set CONFIG.detail_level\nAdd 'l' as alias for city lights toggle","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T01:44:05.00189-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:55:19.709276-08:00","closed_at":"2026-01-02T01:55:19.709276-08:00","close_reason":"Implemented keyboard controls (1-4 quality, l for city lights), fixed lighting direction to stay constant, updated README.md and IMPLEMENTATION.md to accurately describe rasterization-based rendering"}
{"id":"world-46x","title":"Remove dead code and unused properties","description":"Clean up unused code artifacts.\n\n## Dead Code Found\n1. `GlobeConfig.samples_per_cell` property - defined but never called\n2. `CONFIG.enable_clouds` - set to False, no cloud rendering code exists\n3. `LAND_COLORS` vs `LAND_NIGHT_COLORS` - night colors unused when night_mode active\n\n## Options\nA) Remove unused code entirely\nB) Implement the missing functionality\n\n## Recommendation\n- Remove samples_per_cell if quality levels implemented differently\n- Either implement cloud rendering or remove enable_clouds\n- Verify night color logic is correct\n\n## Files\n- globe.py","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T01:45:28.008346-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:45:28.008346-08:00","dependencies":[{"issue_id":"world-46x","depends_on_id":"world-woj","type":"blocks","created_at":"2026-01-02T01:48:46.114277-08:00","created_by":"dylanchidambaram"}]}
{"id":"world-668","title":"Add proper terminal error handling","description":"Terminal state may not be restored if program crashes.\n\n## Current Risk\n```python\nold_settings = termios.tcgetattr(sys.stdin)  # Line 740\ntty.setcbreak(sys.stdin.fileno())\n# If crash here, terminal stays in cbreak mode\n```\n\n## Solution\n1. Wrap entire main() in try/finally with guaranteed restoration\n2. Add signal handlers for SIGINT, SIGTERM\n3. Use atexit module as backup\n\n## Implementation\n```python\nimport atexit\nimport signal\n\ndef restore_terminal():\n    show_cursor()\n    if old_settings:\n        termios.tcsetattr(sys.stdin, termios.TCSADRAIN, old_settings)\n\natexit.register(restore_terminal)\nsignal.signal(signal.SIGINT, lambda s, f: sys.exit(0))\nsignal.signal(signal.SIGTERM, lambda s, f: sys.exit(0))\n```\n\n## Files\n- globe.py main() function","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T01:44:55.42859-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:44:55.42859-08:00"}
{"id":"world-6lj","title":"Optimize render_frame() performance","description":"render_frame() has O(WIDTH × HEIGHT × 8) complexity with expensive operations per iteration.\n\n## Current Bottlenecks\n1. math.sqrt() called twice per sample\n2. Trig functions in rotate_z() and to_latlon() called per sample  \n3. ~38,400 samples per frame at 120×40 terminal\n\n## Optimization Plan\n1. Pre-compute sin(theta) and cos(theta) once per frame\n2. Skip cells outside sphere radius earlier (before dot loop)\n3. Consider lookup tables for common trig values\n4. Optional: Add NumPy vectorization as optional dependency\n\n## Target\n- 20%+ FPS improvement (from 12-15 FPS to 15-18 FPS)\n\n## Files\n- globe.py render_frame() function (~lines 480-650)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T01:44:16.693317-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T02:05:10.024105-08:00","closed_at":"2026-01-02T02:05:10.024105-08:00","close_reason":"Closed"}
{"id":"world-tjo","title":"Add pyshp installation instructions","description":"Shapefile integration requires pyshp but this isn't documented.\n\n## Current Behavior\nCode silently falls back to hardcoded boundaries if pyshp not installed:\n```python\ntry:\n    import shapefile\n    SHAPEFILE_AVAILABLE = True\nexcept ImportError:\n    SHAPEFILE_AVAILABLE = False\n```\n\n## Missing Documentation\n1. README should mention: pip install pyshp\n2. Should explain benefits of shapefile vs hardcoded data\n3. Consider adding requirements.txt with optional deps\n\n## Files\n- README.md\n- (optional) requirements.txt","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T01:48:17.183651-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:48:17.183651-08:00"}
{"id":"world-woj","title":"Fix documentation/implementation mismatch","description":"README.md and IMPLEMENTATION.md describe features that don't exist or work differently.\n\n## Discrepancies Found\n1. Docs claim 3000+ point-plotting but code uses rasterization with polygon fill\n2. Quality levels 1-4 documented but keys not implemented\n3. `enable_ocean_texture` and `show_grid` config options don't exist\n4. `samples_per_cell` property defined but never used\n5. Key 'l' for city lights documented but 'c' is implemented\n\n## Fix Options\nA) Update docs to match code (recommended - code is correct)\nB) Implement missing features to match docs\n\n## Affected Files\n- README.md\n- IMPLEMENTATION.md\n- globe.py (if implementing missing features)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T01:43:54.460845-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:55:19.714682-08:00","closed_at":"2026-01-02T01:55:19.714682-08:00","close_reason":"Implemented keyboard controls (1-4 quality, l for city lights), fixed lighting direction to stay constant, updated README.md and IMPLEMENTATION.md to accurately describe rasterization-based rendering"}
{"id":"world-yfr","title":"Add complete type hints","description":"Several functions missing type hints.\n\n## Functions Missing Type Hints\n```python\ndef get_key():  # -\u003e Optional[str]\ndef clear_screen():  # -\u003e None\ndef hide_cursor():  # -\u003e None  \ndef show_cursor():  # -\u003e None\ndef main():  # -\u003e None\n```\n\n## Also Consider\n- Add return type to load_boundaries_from_shapefile\n- Ensure all Dict/List/Tuple types are fully specified\n\n## Files\n- globe.py","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T01:45:16.35563-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:45:16.35563-08:00","dependencies":[{"issue_id":"world-yfr","depends_on_id":"world-zqy","type":"blocks","created_at":"2026-01-02T01:48:53.77632-08:00","created_by":"dylanchidambaram"}]}
{"id":"world-zqy","title":"Fix global state mutations","description":"Global state makes testing difficult and introduces subtle bugs.\n\n## Current Issues\n```python\nWIDTH, HEIGHT = get_size()  # Module-level globals (line 49)\nCONFIG = GlobeConfig()      # Global mutable config\n\ndef render_frame(theta, night_mode):\n    global WIDTH, HEIGHT    # Mutates globals inside function\n    WIDTH, HEIGHT = get_size()\n```\n\n## Solution\n1. Pass dimensions as parameters to render_frame()\n2. Return dimensions from get_size() and pass through call chain\n3. Consider making CONFIG immutable or passing as parameter\n\n## Refactored Signature\n```python\ndef render_frame(theta: float, night_mode: bool, \n                 width: int, height: int,\n                 config: GlobeConfig) -\u003e str:\n```\n\n## Files\n- globe.py","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T01:44:43.382117-08:00","created_by":"dylanchidambaram","updated_at":"2026-01-02T01:44:43.382117-08:00"}
